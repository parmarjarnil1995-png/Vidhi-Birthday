<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday, Vidhi! ðŸŽ‚</title>

  <style>
    :root{
      --bg1:#ffd6e6;
      --bg2:#ffeef6;
      --card:#ffffff;
      --text:#1c1c1c;
      --accent:#ff4d6d;
      --accent-dark:#e23c5a;
      --gold:#ffb703;
      --yesScale:1;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      overflow-x:hidden;
      background: radial-gradient(1200px 800px at 20% -10%, var(--bg1) 0%, transparent 70%), linear-gradient(160deg, var(--bg2), #ffe1ec 40%, #ffd4ea 70%, #ffeef6 100%);
      animation:bgShift 16s ease-in-out infinite alternate;
    }
    @keyframes bgShift{
      0% { filter:hue-rotate(0deg) brightness(1); }
      100%{ filter:hue-rotate(12deg) brightness(1.05); }
    }

    .card{
      position:relative;
      width:min(840px,94vw);
      background:var(--card);
      border-radius:22px;
      padding:2rem 1.4rem 2.2rem;
      text-align:center;
      box-shadow: 0 18px 50px rgba(0,0,0,.12), 0 2px 10px rgba(0,0,0,.06);
    }

    .emoji-row{
      font-size:40px;
      margin-bottom:.2rem;
      user-select:none;
      text-shadow:0 2px 4px rgba(0,0,0,.08);
    }

    h1{
      margin:.2rem 0 .8rem;
      font-size:clamp(1.6rem,5vw,2.6rem);
      font-weight:800;
      letter-spacing:.2px;
    }

    #type{
      display:inline-block;
      border-right:3px solid var(--accent);
      animation:caret 1s step-end infinite;
    }
    @keyframes caret{50%{border-color:transparent}}

    .sub{
      margin:.2rem auto 1.1rem;
      font-size:clamp(1rem,3.7vw,1.2rem);
      max-width:50ch;
    }

    .bar{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
      justify-content:center;
      align-items:center;
      margin:.8rem 0 1.1rem;
    }
    .pill{
      background:#fff4f7;
      color:#b0364b;
      padding:.5rem .9rem;
      border-radius:999px;
      box-shadow:inset 0 0 0 2px #ffd3dd;
      font-weight:650;
      font-size:.95rem;
    }

    .panel{
      display:grid;
      gap:.6rem;
      margin:1.2rem auto .8rem;
    }
    .countdown{
      font-size:clamp(1.1rem,4.5vw,1.6rem);
      font-weight:750;
      letter-spacing:.5px;
    }
    .mini{
      font-size:.98rem;
      color:#646464;
    }

    .btns{
      display:flex;justify-content:center;gap:.8rem;flex-wrap:wrap;margin:1rem 0 .2rem;
    }
    button{
      border:0;border-radius:999px;cursor:pointer;user-select:none;touch-action:none;
      padding:.9rem 1.2rem;font-size:1.05rem;font-weight:750;
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease, color .12s ease;
    }
    .primary{
      background:var(--accent);color:#fff;box-shadow:0 10px 22px rgba(255,77,109,.32);
    }
    .primary:hover{transform:translateY(-1px);background:var(--accent-dark)}
    .secondary{background:#f1f1f1;color:#444;box-shadow:0 6px 14px rgba(0,0,0,.08)}
    .secondary:hover{transform:translateY(-1px)}

    .carousel{
      margin:1rem auto 0;
      min-height:2.2rem;
      font-size:clamp(1rem,3.7vw,1.2rem);
      color:#3a3a3a;
    }
    .fade{animation:fade 480ms ease}
    @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:translateY(0)}}

    /* Balloons */
    .balloon{
      position:fixed; bottom:-120px; width:36px; height:44px; border-radius:50% 50% 48% 48%;
      background: radial-gradient(circle at 30% 30%, #fff7 0, #fff2 24%, transparent 26%), var(--bcol, #ff7aa2);
      box-shadow: inset -8px -10px 16px rgba(0,0,0,.12);
      animation:floatUp linear forwards;
      z-index:30; pointer-events:none;
    }
    .balloon::after{
      content:''; position:absolute; left:50%; top:98%; width:2px; height:48px; background:#d7d7d7;
    }
    @keyframes floatUp{to{transform:translateY(-120vh) translateX(var(--drift,0px)); opacity:0}}

    /* Confetti canvas and fireworks canvas */
    canvas#confetti, canvas#fireworks{position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:40}

    /* Share toast */
    #toast{position:fixed; left:50%; bottom:20px; transform:translateX(-50%); background:#222; color:#fff; padding:.6rem 1rem; border-radius:999px; font-size:.95rem; opacity:0; transition:opacity .25s ease; z-index:80}
    #toast.show{opacity:.95}
  </style>
</head>
<body>

  <main class="card" role="main">
    <div class="emoji-row" aria-hidden="true">ðŸŽ‚ðŸŽˆâœ¨ðŸ’–</div>

    <h1><span id="type">Happy Birthday, Vidhi!</span></h1>

    <p class="sub" id="sub">
      Jarnil wishes you the happiest birthday and loves you forever.
    </p>

    <div class="bar" id="bar">
      <span class="pill" id="toPill">For: Vidhi</span>
      <span class="pill" id="fromPill">From: Jarnil</span>
      <span class="pill" id="agePill" hidden>Age: <span id="ageVal"></span></span>
      <span class="pill" id="datePill" hidden>Birthday: <span id="dateVal"></span></span>
    </div>

    <div class="panel">
      <div class="countdown" id="countdown">Counting down to your special dayâ€¦</div>
      <div class="mini" id="countMini">Provide ?date=YYYY-MM-DD to enable the live countdown.</div>
    </div>

    <div class="btns">
      <button class="primary" id="wishBtn">Make a wish âœ¨</button>
      <button class="secondary" id="confettiBtn">More confetti ðŸŽ‰</button>
      <button class="secondary" id="shareBtn">Share this link ðŸ”—</button>
      <button class="secondary" id="musicBtn" hidden>Play music ðŸŽµ</button>
    </div>

    <div class="carousel" id="carousel"></div>
  </main>

  <div id="toast" role="status" aria-live="polite">Link copied</div>

  <canvas id="confetti"></canvas>
  <canvas id="fireworks"></canvas>

  <!-- Optional local music: upload a file named music.mp3 in the repo root to enable -->
  <audio id="music" src="music.mp3" preload="none"></audio>

  <script>
    /* ------------------------- helpers & personalisation ------------------------- */
    const qs = new URLSearchParams(location.search);
    const toName   = (qs.get('name') || 'Vidhi').replace(/[<>]/g,'').trim();
    const fromName = (qs.get('from') || 'Jarnil').replace(/[<>]/g,'').trim();
    const dateStr  = (qs.get('date') || '').trim(); // YYYY-MM-DD

    // Title and prominent text
    document.title = `Happy Birthday, ${toName}! ðŸŽ‚`;
    const typeText = `Happy Birthday, ${toName}!`;
    const sub = document.getElementById('sub');
    sub.textContent = `${fromName} wishes you the happiest birthday and loves you forever.`;

    // Pills
    document.getElementById('toPill').textContent = `For: ${toName}`;
    document.getElementById('fromPill').textContent = `From: ${fromName}`;

    // Typewriter effect
    const typeEl = document.getElementById('type');
    typeEl.textContent = '';
    let i=0;
    function typeNext(){
      if(i <= typeText.length){
        typeEl.textContent = typeText.slice(0,i++);
        setTimeout(typeNext, 60);
      }
    }
    typeNext();

    /* ---------------------------- countdown and age ----------------------------- */
    const cdEl   = document.getElementById('countdown');
    const miniEl = document.getElementById('countMini');
    const agePill= document.getElementById('agePill');
    const ageVal = document.getElementById('ageVal');
    const datePill=document.getElementById('datePill');
    const dateVal=document.getElementById('dateVal');

    let targetDate = null;
    if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
      targetDate = new Date(dateStr + 'T00:00:00');
      datePill.hidden = false;
      dateVal.textContent = targetDate.toDateString();

      // Age display uses year difference as of this calendar year
      const now = new Date();
      let age = now.getFullYear() - targetDate.getFullYear();
      const hasHadBirthday = (now.getMonth() > targetDate.getMonth()) ||
                             (now.getMonth() === targetDate.getMonth() && now.getDate() >= targetDate.getDate());
      if(!hasHadBirthday) age -= 1;
      if (age >= 0 && age < 150) {
        agePill.hidden = false;
        ageVal.textContent = age;
      }
      miniEl.textContent = 'Live countdown is enabled.';
    }

    function updateCountdown(){
      if(!targetDate){
        cdEl.textContent = 'Counting down to your special dayâ€¦';
        return;
      }
      const now = new Date();
      // Next birthday occurrence this year or next
      const next = new Date(now.getFullYear(), targetDate.getMonth(), targetDate.getDate());
      if (next < now) next.setFullYear(now.getFullYear() + 1);
      const diff = next - now;

      if (Math.abs((new Date(now.getFullYear(), targetDate.getMonth(), targetDate.getDate())) - now) < 24*60*60*1000 &&
          now.getDate() === targetDate.getDate() && now.getMonth() === targetDate.getMonth()) {
        cdEl.textContent = 'It is your day today â€“ happy birthday!';
        miniEl.textContent = 'Sending sparkles and love all day.';
        return;
      }
      const d = Math.floor(diff / (24*60*60*1000));
      const h = Math.floor((diff % (24*60*60*1000)) / (60*60*1000));
      const m = Math.floor((diff % (60*60*1000)) / (60*1000));
      const s = Math.floor((diff % (60*1000)) / 1000);
      cdEl.textContent = `Countdown: ${d} days, ${h} hours, ${m} minutes, ${s} seconds`;
    }
    setInterval(updateCountdown, 1000); updateCountdown();

    /* ----------------------------- confetti engine ----------------------------- */
    (function(){
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d'); let W,H, pieces=[], running=false;
      function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; }
      addEventListener('resize', resize); resize();

      function spawn(n=200){
        for(let i=0;i<n;i++){
          pieces.push({
            x:Math.random()*W, y:-10,
            w:6+Math.random()*6, h:10+Math.random()*10,
            vy:2+Math.random()*3.5, vx:-2+Math.random()*4,
            rot:Math.random()*Math.PI, vr:-.2+Math.random()*.4,
            color:`hsl(${Math.floor(Math.random()*360)},90%,60%)`,
            life:240+Math.random()*120
          });
        }
        if(!running){ running=true; requestAnimationFrame(loop); }
      }
      function loop(){
        ctx.clearRect(0,0,W,H);
        pieces = pieces.filter(p=>p.life>0 && p.y < H+40);
        for(const p of pieces){
          p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.life-=1;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
          ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
        }
        if(pieces.length) requestAnimationFrame(loop); else running=false;
      }
      window.fireConfetti = () => { spawn(220); setTimeout(()=>spawn(180), 320); }
    })();

    /* ------------------------------- fireworks -------------------------------- */
    (function(){
      const canvas = document.getElementById('fireworks');
      const ctx = canvas.getContext('2d'); let W,H, sparks=[];
      function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; }
      addEventListener('resize', resize); resize();
      function burst(x, y, hue=Math.random()*360){
        const n = 120 + Math.random()*60;
        for(let i=0;i<n;i++){
          const a = Math.random()*Math.PI*2;
          const sp = 1 + Math.random()*4;
          sparks.push({x, y, vx:Math.cos(a)*sp, vy:Math.sin(a)*sp, life:60+Math.random()*40, hue, size:2+Math.random()*2});
        }
      }
      function loop(){
        ctx.globalCompositeOperation='destination-out';
        ctx.fillStyle='rgba(0,0,0,0.18)';
        ctx.fillRect(0,0,W,H);
        ctx.globalCompositeOperation='lighter';
        sparks = sparks.filter(s=>s.life>0);
        for(const s of sparks){
          s.life -= 1; s.x += s.vx; s.y += s.vy; s.vy += 0.02;
          ctx.fillStyle = `hsla(${s.hue}, 100%, 60%, ${Math.max(0,s.life/80)})`;
          ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
        }
        requestAnimationFrame(loop);
      }
      loop();
      window.fireFireworks = (count=4)=>{
        for(let i=0;i<count;i++){
          setTimeout(()=>{
            const x = (innerWidth*0.15) + Math.random()*innerWidth*0.7;
            const y = (innerHeight*0.25) + Math.random()*innerHeight*0.35;
            burst(x,y);
          }, i*220);
        }
      };
    })();

    /* -------------------------------- balloons -------------------------------- */
    function launchBalloons(durationMs=4000){
      const end = Date.now() + durationMs;
